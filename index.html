<!DOCTYPE html>
<html>

<head>
    <title>LaTeX to SVG WASM</title>
</head>

<body>
    <input type="text" id="latexInput" placeholder="eg. \frac{x^2+1}{2}" >
    <button onclick="convert()">Convert</button>
    <div id="output"></div>

    <script src="./l2s.js"></script>
    <script>
        let Module;

        L2SModule().then(instance => {
            Module = instance;
            console.log('WASM module loaded successfully');
            document.getElementById('latexInput').disabled = false;
        }).catch(err => {
            console.error('Failed to load WASM module:', err);
            alert('Failed to load WASM module. Check console for details.');
        });

        function convert() {
            if (!Module) {
                alert('WASM module not loaded yet. Please wait...');
                return;
            }

            try {
                const input = document.getElementById('latexInput').value;
                console.log('Converting:', input);

                const result = Module.ccall('latex_to_svg_wasm', 'string', ['string'], [input]);
                console.log('Result:', result);

                document.getElementById('output').innerHTML = result;
            } catch (error) {
                console.error('Error during conversion:', error);
                document.getElementById('output').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('latexInput').disabled = true;
        });
        document.getElementById('latexInput').addEventListener('input', function (event) {
            convert();
        });
    </script>
</body>

</html>